---
title: "Covariance Estimation With Switchable Constraints  --- Continued 
"
layout: post
date: "2017-05-25"
author: Ryan Watson 
tags:
  - summerAFIT
  - covariance
  - switchable constraints
---

## Testing S.C. on Larger Graphs

To test S.C. on a larger graph, the Manhattan 3500 simulated dataset will be utilized. Using this pose graph, several false loop closure constraints will be added to see well S.C. can handle faults when confronted with a much larger search space.

![Man3500](http://www.lucacarlone.com/images/M3500_eg2o.jpg)  
<p align="center">
Fig 1 :: True Manhattan wold 3500 ground truth 
</p>
<br>

In Figure 2, the Manhattan 3500 pose graph with 80 locrmw@rmw:~/Documents/git/wvupng/core/source/gtsam/build$ ./examples/maxMixExample -g collect1.gtsam --measWeight 10 --mixWeight 0.2 --writeENU
ally clustered false loop closure constraints can be seen. Utilizing this graph we will begin test switchable constraints.

<p align="center">
<a href="https://lh3.googleusercontent.com/HCVKmi-syLSfUJkV4BM9MuEYytIQ75wuZbJGk09kKVlgXvrWXMFonfgsl_YFXuJe-4NkRGclQfEeRgbTs6031an1syw16Esmz9516oh-hQVeozCCIAWj02nqATFZM7auHtY8wS2lUxp0cpYwGG32KrTDBJVWnHlN3aj1ZL3WWpgexetp6CGGzGu5CIwjJSYicCdTK9syAmhOg0-jiii55VzVyMbL93N-PBLWDQvgZ_ymQOLuNC7tAIqhZuE76GjBImKlfs-jT9qRDXo84knfpMn7oiHlbqS_Osdr_wP88PX_R8G17OSFWvyHkS9h_5IStglXNAUjFOTbKS3mxCUTVyX2LaUI9K8TsHHDx3LjhQWavNFNLtN15Afzxcr4VZs__nSmLYw3AQSiP5Pf2nxeNy0s3jkPwBs68VVLEKw5KqimFcLCESyeWfz5LzKCCo26OF4UUl6w9xZ85BCwmrWn2OaqRi38VQnghSQ73hWmiicF0wCzyJwe2CipbWDZ2dvAxYxjOV4xJ6yaxxcvIG-EFkAKiXV8Xv8cgHiZEE5KCinlUfFRc8U5OUBeEGV5BuCGZGmBnyZvrKbAnS8rx2-nx5uOtsK7iowhHpAIYydaSyGnI22pqnmM=w656-h474-no" target="_blank"><img src="https://lh3.googleusercontent.com/HCVKmi-syLSfUJkV4BM9MuEYytIQ75wuZbJGk09kKVlgXvrWXMFonfgsl_YFXuJe-4NkRGclQfEeRgbTs6031an1syw16Esmz9516oh-hQVeozCCIAWj02nqATFZM7auHtY8wS2lUxp0cpYwGG32KrTDBJVWnHlN3aj1ZL3WWpgexetp6CGGzGu5CIwjJSYicCdTK9syAmhOg0-jiii55VzVyMbL93N-PBLWDQvgZ_ymQOLuNC7tAIqhZuE76GjBImKlfs-jT9qRDXo84knfpMn7oiHlbqS_Osdr_wP88PX_R8G17OSFWvyHkS9h_5IStglXNAUjFOTbKS3mxCUTVyX2LaUI9K8TsHHDx3LjhQWavNFNLtN15Afzxcr4VZs__nSmLYw3AQSiP5Pf2nxeNy0s3jkPwBs68VVLEKw5KqimFcLCESyeWfz5LzKCCo26OF4UUl6w9xZ85BCwmrWn2OaqRi38VQnghSQ73hWmiicF0wCzyJwe2CipbWDZ2dvAxYxjOV4xJ6yaxxcvIG-EFkAKiXV8Xv8cgHiZEE5KCinlUfFRc8U5OUBeEGV5BuCGZGmBnyZvrKbAnS8rx2-nx5uOtsK7iowhHpAIYydaSyGnI22pqnmM=w656-h474-no" border="0" alt="man35_100 photo man35Faulty_zps1npeiktb.png"/></a>
</p>
<p align="center">
Fig 2 :: Faulty Manhattan wold 3500 pose graph 
</p>
<br>

The first thing we can look at is the total graph error ( $\chi^2$ ) for both optimization routines. The $\chi^2$ values for $L_2$ and switch factors can be seen in Table 1.


| Optimization Routine        |     $\mathcal{X}^2$       |
| :---------------------------: | :------------------------------------------------: | | :------------------------------------------------: |
|    $L_2$              |   17980.3  | 
|    Switch Factor      |   221.5 |  
{:.mbtablestyle}

<br>

Next, we can visualize the distribution of the magnitude of the optimized weighting parameter, which is provided in Figure 3 as a histogram. From this figure, it can be seen that there is a very clear delineation between what the optimizers believes to be clean observables and those it believes to be faulty. Additionally, it should be noted that the optimizer substantially de-weighted 80 observables, which is the number of faulty constraints that were added to the graph ( currently faults are added randomly to the graph and I do not keep track of their location, so, unfortunately, I can not provided the precision or recall of the weighting scheme today. I'll re-write the code tomorrow to look into it. ).  


<p align="center">
<a href="https://lh3.googleusercontent.com/FOXSaCx8rntVNOwCVKuGrPIe9lQvICJe5ZiDggG77kJGS52Daq4HzRVrJIlZ1u8Tz7-N52YM5cLiZlUVNNpcokMCOGm5shoMQ0ffWBahE3o96Hdc-pcff6YVQDwLYO0E_c_E5vBwex3g8NP5nBcDbH63l8s9C0Q51Sfe4EBkzcrKYr7v6bNSF1N1yjT0TrAdUNsJFhOBr1eHDqfOPKvT-_GlRrqIj8-UPCyZjUsKnTDGWdQRBoQttbXL6dqh0zQPgeeAZoGtKZ17RpYowSZ-kh_bgHvdmsdEJ6bc24g76qkH0OipO_LWWrCelxUVLGrvGxW-PdfkiWT2zr-Z9TunBPjFJbRr1riVXC_PGeuD952F3gT9T1jGhEUJ5BSTLG5JSMT69btu5BIIhoiOV6agAZea4qBVTJJJC6AscCxFpQNkN6VAxOAEeFeyu8rwILlKtJBerPsM7SC_HwC-dvDVeWf8bDD_6_3KesBI38t-YJuZ1J6XRhYLiPLQi2VGEL72Vo_tXQdz6E4R8CKoqr3vFLkJiT7VNfEy2gSqTXUddZyOaEjNaId0VnxYzUPryPTG-6_OLbbsGd-DC8-yWmU65PufOHMP5jr3ygOtZ9htzLJn1pvurBMA=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/FOXSaCx8rntVNOwCVKuGrPIe9lQvICJe5ZiDggG77kJGS52Daq4HzRVrJIlZ1u8Tz7-N52YM5cLiZlUVNNpcokMCOGm5shoMQ0ffWBahE3o96Hdc-pcff6YVQDwLYO0E_c_E5vBwex3g8NP5nBcDbH63l8s9C0Q51Sfe4EBkzcrKYr7v6bNSF1N1yjT0TrAdUNsJFhOBr1eHDqfOPKvT-_GlRrqIj8-UPCyZjUsKnTDGWdQRBoQttbXL6dqh0zQPgeeAZoGtKZ17RpYowSZ-kh_bgHvdmsdEJ6bc24g76qkH0OipO_LWWrCelxUVLGrvGxW-PdfkiWT2zr-Z9TunBPjFJbRr1riVXC_PGeuD952F3gT9T1jGhEUJ5BSTLG5JSMT69btu5BIIhoiOV6agAZea4qBVTJJJC6AscCxFpQNkN6VAxOAEeFeyu8rwILlKtJBerPsM7SC_HwC-dvDVeWf8bDD_6_3KesBI38t-YJuZ1J6XRhYLiPLQi2VGEL72Vo_tXQdz6E4R8CKoqr3vFLkJiT7VNfEy2gSqTXUddZyOaEjNaId0VnxYzUPryPTG-6_OLbbsGd-DC8-yWmU65PufOHMP5jr3ygOtZ9htzLJn1pvurBMA=w1024-h538-no" border="0" alt="switchFreq photo swFreq_zpsxnmzlb2s.png"/></a>
</p>
<p align="center">
Fig 3 :: Switch Constraint Weighting Histogram 
</p>
<br><br>

## Testing Accuracy of Covariance Estimate

Now that we have switchable constraints working in GTSAM, we need to evaluate the accuracy of its covariance estimate. To do this we will use the measure, which was introduced in [this paper](http://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=1543265&tag=1), shown below,

$$ d(P_1,P_2) = 1 - \frac{Tr \lbrace P_1P_2 \rbrace }{||P_1||_f ||P_2||_f} = 1 - \frac{<vec \lbrace P_1 \rbrace , vec \lbrace P_2 \rbrace > }{ ||vec \lbrace P_1 \rbrace ||_2 || vec \lbrace P_2 \rbrace ||_2 }  \in [ 0,1 ] , $$

where $P_1$ is the true covariance, which is calculated as $P_1 = E[(x-\hat{x})(x-\hat{x})^T]$, and $P_2$ is the covariance provided by the estimator. 

### Testing On Simple Graph

Using the simple graph that contains one false loop closure between the second and fourth nodes, as depicted in Figure 4, we will evaluate the accuracy of the covariance estimate for $L_2$ and switch constraints.

<p align="center">
<a href="https://lh3.googleusercontent.com/_IUj34MePwYh8UehoEXmsRGDAYQoFBeZv8ntvhgrhLbVKQ70uexImVplPy1S86ku95c5v0_-bcecL8YGMO0T7upXBIWy3iehDg8Rmd1g_m1YLVEYkCO8Q1w5cKyT5z_8lghS4afx0mUlrSC4EuyivfpfDjqAXOMRwjqHI8XNiR-TTwXPN3gGIoKSVZybC38BzSOfSWP-09q-g7EcaYb-w5ohqZMHtx64tiHBld121vpiHw3pm7_9bzs4FASNTa3wHOpb8p33jeI7-KBnvYK7y0gUzbrVHzAoIyccDLnACL0TAmXJ9PTnd9YT7MuM1AmaADAKVfPb5H4G7OfO97fcS9IG2JAjXN_aZ4wTdNftNynBKg-qUVXJSp5kGk_6FGQa5ARNx9hlm0WGOAHBPdXygjQZ9Z3n4ON8rwEIp6n3nB7bd-A3tjLGtNElgY89oKTzcOvilMsLGVVD6EylOXAt6XxSvtg-8ACcOf_Ul5RojRhPsNPdMbxslkqPyVSZP68SL2uMWZx7yAo7HjPTAazWlYJixn6--_L5fJMqa2lOZbcA6-kJiV6jDoIcLSrL37e3MymfRZlE3lWZwIJa491ADAZ1s1azRxdjm9dOBsjsjQ5_CadLlnCQ=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/_IUj34MePwYh8UehoEXmsRGDAYQoFBeZv8ntvhgrhLbVKQ70uexImVplPy1S86ku95c5v0_-bcecL8YGMO0T7upXBIWy3iehDg8Rmd1g_m1YLVEYkCO8Q1w5cKyT5z_8lghS4afx0mUlrSC4EuyivfpfDjqAXOMRwjqHI8XNiR-TTwXPN3gGIoKSVZybC38BzSOfSWP-09q-g7EcaYb-w5ohqZMHtx64tiHBld121vpiHw3pm7_9bzs4FASNTa3wHOpb8p33jeI7-KBnvYK7y0gUzbrVHzAoIyccDLnACL0TAmXJ9PTnd9YT7MuM1AmaADAKVfPb5H4G7OfO97fcS9IG2JAjXN_aZ4wTdNftNynBKg-qUVXJSp5kGk_6FGQa5ARNx9hlm0WGOAHBPdXygjQZ9Z3n4ON8rwEIp6n3nB7bd-A3tjLGtNElgY89oKTzcOvilMsLGVVD6EylOXAt6XxSvtg-8ACcOf_Ul5RojRhPsNPdMbxslkqPyVSZP68SL2uMWZx7yAo7HjPTAazWlYJixn6--_L5fJMqa2lOZbcA6-kJiV6jDoIcLSrL37e3MymfRZlE3lWZwIJa491ADAZ1s1azRxdjm9dOBsjsjQ5_CadLlnCQ=w1024-h538-no" border="0" alt="incorrectOdo photo odometryTestCorrect_zpsgtdn0vsr.png"/></a>
</p>
<p align="center">
Fig 4 :: Simple Graph With One False Loop Closure Constraint  
</p>
<br>


In Figure 5, the discrepancy between the true covariance and the estimated covariance for both estimators, with respect to the metric described above, can be seen. From this figure, it seems as though, in general, $L_2$ is providing a better estimate of the covariance; however, this is only one test case. 


<p align="center">
<a href="https://lh3.googleusercontent.com/2LIGhJsXYtCGw7NA0m0dzZc5PE2q0vQaeruUv-7eJVHtjACxCQjTvhE3Eb9IFubeucYIHjPXZvVybrcrpdJFFwDXgPlO4ZkCCj3m3UXMWrcN6byHwW1yoCJCm7XQd_nYpiKdlTCdvD2UcUnvaYITvHmdbFEWPsOmFL6aba5f2NemPDzuej5f5lkERGbGnBCvLAUe11sHJRmxqOO6MPK2qqXfT0e-aPTN6thlCHspbAUtUrr1GnKIU6u57t-mA7bCT49Xc666RL0tQfLuSwh-Jwm55JN2ey935iAYpL1SkexDezAZMK5dcCt2uO61L2TV2gdVWfD_x6Ek6KlSUf9E-2PMP2nt_q9Xo8r4UTnIZHMpbKvqbu0oOlHX6B3fjAZw-yhCeWMxM85xnhLGS-5cVG-vgDskfztEx9wDiiyoEuBzxMdHeH__OHLS8KFwJd17y6RYZz0x2wDVspHf2YvQrSNgIo3c79b2EJVWjnv4oT9LSZeuTzba17S8upkg9DcL1vW9DZpie19iFfbBCS6eMkcZhCEZQrfL7AdEfcs0ypDeckJKoGwLZ8x2AUUNQT7LJJGxaGrwS_9PoPeE-GgEkWQ_W6rrXyXYXtiLDy5_IGLfOPD4Kk6C=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/2LIGhJsXYtCGw7NA0m0dzZc5PE2q0vQaeruUv-7eJVHtjACxCQjTvhE3Eb9IFubeucYIHjPXZvVybrcrpdJFFwDXgPlO4ZkCCj3m3UXMWrcN6byHwW1yoCJCm7XQd_nYpiKdlTCdvD2UcUnvaYITvHmdbFEWPsOmFL6aba5f2NemPDzuej5f5lkERGbGnBCvLAUe11sHJRmxqOO6MPK2qqXfT0e-aPTN6thlCHspbAUtUrr1GnKIU6u57t-mA7bCT49Xc666RL0tQfLuSwh-Jwm55JN2ey935iAYpL1SkexDezAZMK5dcCt2uO61L2TV2gdVWfD_x6Ek6KlSUf9E-2PMP2nt_q9Xo8r4UTnIZHMpbKvqbu0oOlHX6B3fjAZw-yhCeWMxM85xnhLGS-5cVG-vgDskfztEx9wDiiyoEuBzxMdHeH__OHLS8KFwJd17y6RYZz0x2wDVspHf2YvQrSNgIo3c79b2EJVWjnv4oT9LSZeuTzba17S8upkg9DcL1vW9DZpie19iFfbBCS6eMkcZhCEZQrfL7AdEfcs0ypDeckJKoGwLZ8x2AUUNQT7LJJGxaGrwS_9PoPeE-GgEkWQ_W6rrXyXYXtiLDy5_IGLfOPD4Kk6C=w1024-h538-no" border="0" alt="incorrectOdo photo odometryTestCorrect_zpsgtdn0vsr.png"/></a>
</p>
<p align="center">
Fig 5 :: Simple Graph With One False Loop Closure Constraint  
</p>
<br>


####  Will be continued tomorrow...

