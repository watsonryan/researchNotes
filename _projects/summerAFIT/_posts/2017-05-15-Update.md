---
title: "Data Generation & Initial Testing "
layout: post
date: "2017-05-15"
author: Ryan Watson
tags:
  - summerAFIT
  - data generation 
  - switchable constraint
---

# Data

## Simulated Data 
Using [PPP/INS](https://github.com/jsngross/WVUPNG/tree/master/matlab/pppINSSim) simulator to generate GPS observables for two GNSS receivers, which are rigidly mounted to a platform. One receiver will be high fidelity ( i.e. final products with good models ) but the observables could have faults $ f \sim \mathcal{N}(0,25) $. The second receiver is lower fidelity ( positioning error $ \sim 15 m$ ); however, the observables generated by this receiver will have no faults. 


Generated 10 Hz GNSS observables for the flight profile depicted below.  

<img src="https://lh3.googleusercontent.com/_oOupjYrcPT9dyeUhO4bveV2OkKQ-n_pl4Ia2YltSGYZujetQ92DB2nI8EJ1tufz0OZgrbJP_n4QoZqqJfLD2wsG3HbS60Mgyb2fDZUqiR7ag7rGkUvVZ9vs1YRqxk6kOtMKZWYxvXpl2ZeXiWbmDaNn-5hPi8_62GM2Pa44kajRho4jLnUZhnaDsRg3vmWy0IJCjMYgLPiJmclu2_ob0awSjKXb5bkmrL7bpT-qMc3fqk4-MMILbEEyPfYlFz-5zc5tYtNy9qBmHhT891W8yWOS6Aus5rPD57hggyhLFqkN-Hqh3Z0_JTjybTiM7Yg-jvB_NrVZcHSHEpktrihrGLuXh_q2IPv5gJkIqfOb7teVzPZV-SV3hAyDeJluCi_VLfscU-_9rgRwMqgvZMH6TN-qDcIhJ86lyG0e0h5-lMV0Rbxiphc-NL8hXGR0Yz04OJzn-kl-oRE7YRFumgxIgnkdIuOodSOUFtEwpMzYdcAWJgXvALLxVSQ23G5FeHnUo9D7aeuUd75HLO7VQGlvGiaE0k-KATYEup0IBtPhgsoq1bKtWlIPA7c3TihHCd4eC-i_-yB4-JM=s1024-w1024-h506-no" alt="ENU Path" align="middle" >

<p align="center">
Generated ENU flight profile
</p>

<img src="https://lh3.googleusercontent.com/JfqsOTz2lkBKXTeospjL7i2ezn9LuEjOoq-5jSh4Jz6Aj8LiygYp3G6u2oLMLbOaV2kujDIaR0HSsQrLbU3vLED0-3b4Nv-IiKHvVDL-RPeE6r11BGgZ_ix4ZLeyiHdv10FfOGuJxqiONpfv5kOQbFb4kf8DBWAFJHjsJkawR_r8mpSw_ocpAJU8EVnkDSj0HDRpG_6nJKBIXHwCTsLFiY-FR-b1k-5vUWm3acJFYfWFQ7ibz26ckrykBkwACUg3ofPD235mRx9AXwDBb6znA8QKthnFMvy8NsTEoe-rSbPWe-tj2gGtV_Mk8sm_pvzMYN0gu0qVkuMlDxYjebPTGi1TqeLI1SmABTqy_b4gh7OM8ygzkDNJ1O8zx_s33z6qgtk9EbeW2wBWXv-iUDqhnJfgeREdGCaUEYCpPDu-ywF_NUTjhDywn0lcCzulsUyay2GZky7qTkBs8JRuNf2B25XQer4O-nD1MRwb85LC9TjCUABnb8oCyvKSFChCVpQNzop1g0IxqF6ak6Kehyx0Wfu4DVxW_VFpHCUC3o7TBCpd8T8468KuBArnE9mlttHdz2LHKlR04SQ=s1024-w1024-h506-no" alt="ENU Velocity" align="middle" >
<p align="center">
Generated ENU velocity profile
</p>

<img src="https://lh3.googleusercontent.com/K-M-YbfIf_Uf1Cfhj_mQiJ9FdkYtStG60UgX4w1f1CVd9EKQj0nXvTB5QrUsG-0wQ1QXuE5lSITbR-DXVJchGziYoaTSxHBOVkkdwUMdjLsxI4muJvEywdI2fRGHLNes1mzf9tA2xPMhWv-kCyZWCAyn4xxPDZnki-qck29Ts48l-jm6oMWY-nP71huP2hBTCe-0-FTmwqHAOSopLpr3mSslP5xTnrMCGVCz22cpLrS3rmGSw20bkrT0NrsfAyNGTl7CuZfnVJVxKUMKOAmtjEDn3OMH-ZAiNE11ev_SauRzuSxSqTPTchUeaMSBAVBCk1u0ZrX263w7PgnKtpjljFxAOPi5ianizi2XlHA9d246pu4xoRi1z0Cf1dgTEpJ72FtKPwLWsN-AtgsuRvMJz66sf6sRvKzKkfMuP6Pcw21cVA4cI6m701JjG01AqjCGytKGO41o6oAs9trVeeAjHmYgfbcIeXc_hoPsyKI2ZG67aFsN8xcJnrtU1luczAGrVX7wiwNlrjeW5SlF6p9_LKB4mz6GGKCq3zP-rz0rme_KzBNnti9uPQ6DQW5v0Vyf0p0Tx2n6BqM=s1024-w1024-h506-no" alt="Attitude" align="middle" >
<p align="center">
Generated attitude profile
</p>

## Collected Data in Degraded Environment 
In addition to simulated data, [TU-Chemnitz](https://www.tu-chemnitz.de/projekt/smartLoc/gnss_dataset.html.en) has made available 4 high quality data-sets. Currenlty talking with [Tim](tim.pfeifer@etit.tu-chemnitz.de) to see if he can provide us with the raw INS measurements. A brief description of the data-set is provided in the table below. A more detailed description is provided in [this paper](https://www.tu-chemnitz.de/projekt/smartLoc/paper/reisdorf2016.pdf).

| Sensors            |     Info                      |
| :---------------------------: | :------------------------------------------------: |
| Low Cost GPS       |  U-Blox EVK-M8T    ( $\sim$ meter lever error )      |
| High Quality GPS   |  Novatel SPAN Differential  ( $\sim$ decimeter lever error )   |
| Odometry           |                               |
| Camera             | 5 Cameras on-board            |
{:.mbtablestyle}

# Initial Testing 

 
For this initial test, we are assuming that we have one high quality receiver with erronous data, and one lower quality receiver with fault free data. With this data, we can construct the pose graph using the low quality receiver ( i.e. take the low quality receiver position as truth ) and optimze the position using the high fidelity receiver's raw observables. 


<img src="https://lh3.googleusercontent.com/Nh2xF90wgF8HX96CTpMHY7gIZBWD7DkcWk2gRJ9wYqACWPtV1Fb8qwbuICkEYiobdZW63_bTp1QP-wrqFpexF5G8hNSh31Xdl8Oa4KkMt0hxaiE58fPDQtotdnSTU6-aLDVvR1f31SsAjT2mwJusu5lvtjI5ix82Rqz9_UtBEBO5mbOHe4ZuFsSIuoOL5Kk-E-2xIuf1Oh-69g_v54ACKjtziGvbP2ZKQlzKQiN_y5xNB3C1JDJlvtfkdnCMVQp0z4gHRm1g_o5OTqXqHDN0njkoqJHuDOxgCjyeE3XytM-6Xuj1TbXKQoS6wJm3U7JjPDjK5PUPNBDx6f2FbQQexycO1bgx9yT66LMLt8LYgy867YaqBkhWUp5I30WybGP344wzSGLw8uTP-nnl2lQbglnVMMya2zB2uesls7sfMwE9MwS7__mg4xff23DgNMUakxA9k-YwJzugDslQG639a60Va-VobfNbHqJcrrAc-k4iXhn7-pYjBbZUffRNBspn7x8-TRECMQaMwNhg_J0LFlmMdLhbvFCa2NXz1jbV5UDp5shZcbu5WkeWLsmqwBeYHcP2Bz0TDEQ=s759-w759-h304-no" alt="Initial Graph" align="middle" >
<p align="center">
Inital factor graph
</p>

In the graph, $e_i$ represents an error function or probabilistic constraints applied to the state at the specified time-step. When Gaussian noise is assumed, the error function is equivalent to the innovation residual of the traditional Kalman filter. Utilizing this information it is easy to see that the optimal state estimate can be calculated through a traditional non-linear least squares formulation ( i.e., Levenberg Marquardt ) that minimizes the error over the graph. 
	
$$e_i = H_i(X_i) - Z_i$$ 
	
$$\hat{X} = argmin \sum_i  \lvert \lvert e_i \rvert \rvert^{2}_{\Sigma}$$ 

Whenever errors are present in the observations, methods to make the optimization more robust must be incorporated. One such method is the switchable constraint, which can be thought of as an observation weight that is be optimized concurrently with the state estimates. The addition of the switchable constraint to the optimization processes modifies the cost function. The modified cost function is provided below, where s is the switchable constraint which is confined to the interval of zero to one. A graphical depiction of this is shown in the Figure below, where observable $m$ at epoch $n$ exceeded the pre-defined residual threshold.
	
$$\hat{X} = argmin \sum_i  \lvert \lvert e_i \rvert \rvert^{2}_{\Sigma} + \sum_i  \lvert \lvert s_i * e_i \rvert \rvert^{2}_{\Sigma} + \sum_i  \lvert \lvert 1 - s_i \rvert \rvert^{2}_{\Xi}$$ 

<img src="https://lh3.googleusercontent.com/eZ4ObX-4hzcjVQE_x93EwjuaoUDm7YreKTkenGRn7zLa3HLtQNkEKc37PtMkU3HwakVGWVwllOXfl2Nco8fNuIXiEa7KrvFHK1Iq14ph1p1n-TG1QlByMEYAvUZ2_TcArCNnf6ry3Cb-o8c6NEIv_ffID2ASph24KQvB3YGY7zuB0wxL4rHWs20mX8YoaW2oRiRGvXHIqkwamEiObQlerxeD-HLzGa29VhLk6FhmJ8cFePvjoxY0MQTGC63ngMFhAheC1YVnmX1FnZqPLI7PBO8QLTlyPum3yj7YOX1m4KldqpkBusAm-BMf3P2WpcvEmfsc7DxkKpPbBeidKVf0ceb-wlcOxXTFS7at5sHwVuOAXhnaW5OScCrGj6ZB9GRGwhbicIHasHJxDOAF1VmUuwg3nVu1WTUKCMdMHYuZAtoY3V240CWQvhe5UdTBkG5IvUgY3FgjE6BR34o1VeznoC2aMGaRj20w7tO64jikHDm-3WQnmIDOVnzTw6abvUreaj1-VaScC82B12kk_H9hxAoA4Ir7531WCfWJEofKtiqN7Mu5hYT4jAjyZ1RGNX4YqS5OPF3B_S0=s880-w880-h324-no" alt="Switch Factor Graph" align="middle" >
<p align="center">
Graph with switch factors incorporated
</p>


## Sensitivity Testing:

### 1) Faults randomly added to observables : 

### 2) Slowing increase magnitude of fault on specific satellite  : 



# To Be Continued ...  


