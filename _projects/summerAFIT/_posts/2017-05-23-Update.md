---
title: " M-estimator affect on covariance --- continued  "
layout: post
date: "2017-05-23"
author: Ryan Watson 
tags:
  - summerAFIT
  - covariance
  - m-estimator
  - adaptive m-estimator
  - isam
---

## Evaluating Covariance Estimate from M-Estimators 


After yesterday's test, there was some doubt as to how the M-Estimator is scaling the covariance matrix. To evaluate if this is an actual issue in the code or just an issue with me not understanding how GTSAM applies the M-Estimators weight to the information matrix, I tested multiple M-Estimators to see if the trend from yesterday persists.


<p align="center">
<a href="https://lh3.googleusercontent.com/_IUj34MePwYh8UehoEXmsRGDAYQoFBeZv8ntvhgrhLbVKQ70uexImVplPy1S86ku95c5v0_-bcecL8YGMO0T7upXBIWy3iehDg8Rmd1g_m1YLVEYkCO8Q1w5cKyT5z_8lghS4afx0mUlrSC4EuyivfpfDjqAXOMRwjqHI8XNiR-TTwXPN3gGIoKSVZybC38BzSOfSWP-09q-g7EcaYb-w5ohqZMHtx64tiHBld121vpiHw3pm7_9bzs4FASNTa3wHOpb8p33jeI7-KBnvYK7y0gUzbrVHzAoIyccDLnACL0TAmXJ9PTnd9YT7MuM1AmaADAKVfPb5H4G7OfO97fcS9IG2JAjXN_aZ4wTdNftNynBKg-qUVXJSp5kGk_6FGQa5ARNx9hlm0WGOAHBPdXygjQZ9Z3n4ON8rwEIp6n3nB7bd-A3tjLGtNElgY89oKTzcOvilMsLGVVD6EylOXAt6XxSvtg-8ACcOf_Ul5RojRhPsNPdMbxslkqPyVSZP68SL2uMWZx7yAo7HjPTAazWlYJixn6--_L5fJMqa2lOZbcA6-kJiV6jDoIcLSrL37e3MymfRZlE3lWZwIJa491ADAZ1s1azRxdjm9dOBsjsjQ5_CadLlnCQ=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/_IUj34MePwYh8UehoEXmsRGDAYQoFBeZv8ntvhgrhLbVKQ70uexImVplPy1S86ku95c5v0_-bcecL8YGMO0T7upXBIWy3iehDg8Rmd1g_m1YLVEYkCO8Q1w5cKyT5z_8lghS4afx0mUlrSC4EuyivfpfDjqAXOMRwjqHI8XNiR-TTwXPN3gGIoKSVZybC38BzSOfSWP-09q-g7EcaYb-w5ohqZMHtx64tiHBld121vpiHw3pm7_9bzs4FASNTa3wHOpb8p33jeI7-KBnvYK7y0gUzbrVHzAoIyccDLnACL0TAmXJ9PTnd9YT7MuM1AmaADAKVfPb5H4G7OfO97fcS9IG2JAjXN_aZ4wTdNftNynBKg-qUVXJSp5kGk_6FGQa5ARNx9hlm0WGOAHBPdXygjQZ9Z3n4ON8rwEIp6n3nB7bd-A3tjLGtNElgY89oKTzcOvilMsLGVVD6EylOXAt6XxSvtg-8ACcOf_Ul5RojRhPsNPdMbxslkqPyVSZP68SL2uMWZx7yAo7HjPTAazWlYJixn6--_L5fJMqa2lOZbcA6-kJiV6jDoIcLSrL37e3MymfRZlE3lWZwIJa491ADAZ1s1azRxdjm9dOBsjsjQ5_CadLlnCQ=w1024-h538-no" border="0" alt="incorrectOdo photo odometryTestCorrect_zpsgtdn0vsr.png"/></a>
</p>
<p align="center">
Fig 1 :: Odometry test case with one false loop-closure 
</p>
<br>


Using the same pose graph that was utilized yesterday, which is shown above, the $L_2$, Huber, DCS, and Geman-McClure M-Estimators were tested.


First, the case were no false constraints are added to the graph was tested. As expected, when no false constraints are added to the graph, all estimators provide the same covariance estimates. The final solution is shown in the figure below ( Note :: all four estimators overlap ).

<p align='center'>
<a href="https://lh3.googleusercontent.com/iQ8lJyg-0QpRxdl3bUxdC02vPya5knHObVna4dvbhZrW9mHqSv8AWbLmzYNfjP0dQCsEP0xFrb6q03_LrWDfXGRTb7-60U7fwkPGvuMGjf-K4fu39sV_VfIxa5VgXfg2uZVGkzlSdbUqvMMox_imC1iKSwe1CSsuuDbe-rCgC8sZk9UNUeJaAXSB4BEGCsxljZpGjuKwoyGOCx0N--wOn3h-faGZuH3xRCwOwARV_CG-GPzs3HtcTmg66kWqksRMFyKAteQs-vjPDMz69nUl9t25qfFGPrTneS7TS30n7lFnUjAgnKtMdnvkmC7BX7Yzstpx3hQ3LmzFITl0TRakBDOIBJWN5SQPc7OTn02u3mDggmKY08DnCLQaHdAVSfeGBCF_TBvpfzjiviEUIrFlhjKQ_L6f4ItchMo8E0D_nZtAoeow_6hn1WQUs0Ohea6pcRIenDTIOIwzZF2Wkh9povJXSZxGZWDRxngUkV342RKux1ojk3WeBY2RJfm8t3hdn9smtEJMyfXdBCvZDDZtw9CU1PWsGjuHyw96cBiPwSCZG_t0-Llaey9Gk_QxORArLrXRssfdwXAObtKfSkREwAGsTb0K0fhABwcO0EeEHobxdfs_26RK=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/iQ8lJyg-0QpRxdl3bUxdC02vPya5knHObVna4dvbhZrW9mHqSv8AWbLmzYNfjP0dQCsEP0xFrb6q03_LrWDfXGRTb7-60U7fwkPGvuMGjf-K4fu39sV_VfIxa5VgXfg2uZVGkzlSdbUqvMMox_imC1iKSwe1CSsuuDbe-rCgC8sZk9UNUeJaAXSB4BEGCsxljZpGjuKwoyGOCx0N--wOn3h-faGZuH3xRCwOwARV_CG-GPzs3HtcTmg66kWqksRMFyKAteQs-vjPDMz69nUl9t25qfFGPrTneS7TS30n7lFnUjAgnKtMdnvkmC7BX7Yzstpx3hQ3LmzFITl0TRakBDOIBJWN5SQPc7OTn02u3mDggmKY08DnCLQaHdAVSfeGBCF_TBvpfzjiviEUIrFlhjKQ_L6f4ItchMo8E0D_nZtAoeow_6hn1WQUs0Ohea6pcRIenDTIOIwzZF2Wkh9povJXSZxGZWDRxngUkV342RKux1ojk3WeBY2RJfm8t3hdn9smtEJMyfXdBCvZDDZtw9CU1PWsGjuHyw96cBiPwSCZG_t0-Llaey9Gk_QxORArLrXRssfdwXAObtKfSkREwAGsTb0K0fhABwcO0EeEHobxdfs_26RK=w1024-h538-no" border="0" alt="l2WithFault photo l2WithFault_zpsza8q9fee.png"/></a>
</p>
<p align='center'>
Fig 2 :: Optimized no fault pose-graph and associated covariance estimates for all estaimators
</p>
<br>


Next, we test the case that is shown in Figure 1 where one false constraint is added to the graph. First, we will test $L_2$ optimization, which is shown in the figure below. Obviously, this is not a good estimate with respect to node position or estimated uncertainty in the state.

<p align='center'>
<a href="https://lh3.googleusercontent.com/gVZo5S32tQ2IsYz5msyAsGrwh6aiZPneJnfbJm1IGeVAeI6G-AHW0Wxg-Lm1NuWCuiZVz8-eeEkAmr6J9mdjSDP2xul3-6o-MUiXrUoeiOhNj8obg-p1rIq3oZM-_ouM4qXYm8H_Ali1c-iVy4eBJw8gBFtIq3SffYghd1zmov41onseMrfCqZFZCY_zUPx-ZFZvUl0Yq0Nt-Mrx4iy_Nv6i7tj4vsPM5_OwoCh8ekma8Xo7CaPhX6xfZXqzPn-0a-QGIXOTXi6WIxyPgUUteBv_CwJjM_v67Urz-vn04U2DdrxCZ9VrR0rvstpGViVmhgML_CeI2_uNoburTYjvYsb7PVX-8pO1kDacTLauqr8JG9D2cC6VZA3JoUq9-R0G2zZrgRo9A3QfasJZZWdgdb8jLog5LJcC_HLYujWKzDBxKzIs8fP6F1aFO2NaBevV_JYEj-xGXZVfAhh48NWAiQGJDXq4ucz_L-hY19spdNpqJnSKHHtWVhEEfk-tgXSM15chp4cumJdefAstKpllm7Xr1KCrChZPAmXO8eeRxq2DsUbGjyoD8tujyB80KNxyI-PeDz5NdOv2gpc0Soo397mK-0Jf_yubJOcw0hbKKyd8PMRZ6xLf=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/gVZo5S32tQ2IsYz5msyAsGrwh6aiZPneJnfbJm1IGeVAeI6G-AHW0Wxg-Lm1NuWCuiZVz8-eeEkAmr6J9mdjSDP2xul3-6o-MUiXrUoeiOhNj8obg-p1rIq3oZM-_ouM4qXYm8H_Ali1c-iVy4eBJw8gBFtIq3SffYghd1zmov41onseMrfCqZFZCY_zUPx-ZFZvUl0Yq0Nt-Mrx4iy_Nv6i7tj4vsPM5_OwoCh8ekma8Xo7CaPhX6xfZXqzPn-0a-QGIXOTXi6WIxyPgUUteBv_CwJjM_v67Urz-vn04U2DdrxCZ9VrR0rvstpGViVmhgML_CeI2_uNoburTYjvYsb7PVX-8pO1kDacTLauqr8JG9D2cC6VZA3JoUq9-R0G2zZrgRo9A3QfasJZZWdgdb8jLog5LJcC_HLYujWKzDBxKzIs8fP6F1aFO2NaBevV_JYEj-xGXZVfAhh48NWAiQGJDXq4ucz_L-hY19spdNpqJnSKHHtWVhEEfk-tgXSM15chp4cumJdefAstKpllm7Xr1KCrChZPAmXO8eeRxq2DsUbGjyoD8tujyB80KNxyI-PeDz5NdOv2gpc0Soo397mK-0Jf_yubJOcw0hbKKyd8PMRZ6xLf=w1024-h538-no" border="0" alt="l2WithFault photo l2WithFault_zpsza8q9fee.png"/></a>
</p>
<p align='center'>
Fig 3 :: $L_2$ optimization with faultly pose-graph and associated covariance estimates
</p>
<br>


Now, we test the same graph with three M-Estimator: DCS, Huber, and Geman-McClure ( Because the kernel width equals 1 the DCS and Geman-McClure solutions should be exactly the same. ). The results for the M-Estimators are shown in Figure 3. Note, that I only ploted the DCS & Huber solutions becase the DCS and Geman-McClure solutions matched. 

<p align='center'>
<a href="https://lh3.googleusercontent.com/Tsjo3gW3G8Wq7ujlVILoD3SDOaOzPNJ6_usI6eKSrVTiJ1Je9HDM0pgZhAiEec-bokXDrA3b5QIB4FyeEWM2Fx7eoCF7dZVPxmrj4M_VrY02TVnfDTeT2J_Qi7dCn5Q_O2wWhEvj8M0odP0n7tVP42HQBbD5MbWi3fnToyWWE7SzJSBETURqEmfp5OBgY7FFy-KvwlSOj8YCGSAl_WK-nqgZTabMvg7cXeLMB3nVmx69rbUZWtQkYIb-sgmWoBgvlgXvbFwde9EMy7HjWxMmj1ZGLQzEryNZ3w-Nb9uoGJJYttymn8v0-QZSnS8N4FkzELqnBCDxR_lalBcvMKPeTC0xeaeWTNK2L96-jh6MlStw_5Z0SjgN0-BGRKFmO44WjfhnKXsjpWT0Jq8ycKlcc7oYvxCPyL0lAEWecI8enU1y4nIhUXzYW0WYgjzLWXwneUJ-U0yjD2czfPHEWdfYiwzTP5MS61ewBNwD_gnat_YfnS82XymR5PTUpk9TH14N_oxPa7ZUJap4Qql5TYTUxZbCTfkwJotQQPPb4mK8N6F8BfSFWbYDsxjVcOD_yFK0nuqvg03JKorKLah6Ta9m-8fcjp6gZuIlc5B5hXhUqKRdjgVLuSzs=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/Tsjo3gW3G8Wq7ujlVILoD3SDOaOzPNJ6_usI6eKSrVTiJ1Je9HDM0pgZhAiEec-bokXDrA3b5QIB4FyeEWM2Fx7eoCF7dZVPxmrj4M_VrY02TVnfDTeT2J_Qi7dCn5Q_O2wWhEvj8M0odP0n7tVP42HQBbD5MbWi3fnToyWWE7SzJSBETURqEmfp5OBgY7FFy-KvwlSOj8YCGSAl_WK-nqgZTabMvg7cXeLMB3nVmx69rbUZWtQkYIb-sgmWoBgvlgXvbFwde9EMy7HjWxMmj1ZGLQzEryNZ3w-Nb9uoGJJYttymn8v0-QZSnS8N4FkzELqnBCDxR_lalBcvMKPeTC0xeaeWTNK2L96-jh6MlStw_5Z0SjgN0-BGRKFmO44WjfhnKXsjpWT0Jq8ycKlcc7oYvxCPyL0lAEWecI8enU1y4nIhUXzYW0WYgjzLWXwneUJ-U0yjD2czfPHEWdfYiwzTP5MS61ewBNwD_gnat_YfnS82XymR5PTUpk9TH14N_oxPa7ZUJap4Qql5TYTUxZbCTfkwJotQQPPb4mK8N6F8BfSFWbYDsxjVcOD_yFK0nuqvg03JKorKLah6Ta9m-8fcjp6gZuIlc5B5hXhUqKRdjgVLuSzs=w1024-h538-no" border="0" alt="m_est photo m_estWFaultUpdate_zpsrebenk5r.png"/></a>
</p>
<p align='center'>
Fig 4 :: Optimization of faultly pose-graph and associated covariance estimates for M-Estimators
</p>
<br> 



### Testing Sensitivity to Kernel Width 

Next, the sensitivity of the Huber cost function to the user defined kernel width is tested. The sensivity is depicted in the image below. Obviously, the kernel width can have quite an affect on the solution. I'm going to start looking into [adaptive M-Estimators](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.526.4522&rep=rep1&type=pdf) that can adjust kernel width during optimization. 

<p align='center'>
<a href="https://lh3.googleusercontent.com/oVwMDLP00OKkZogh2HuxmyduDpwRye-Ep9ziUoN_Pj9Q-r7LBajX21pkspFwV8unDOMVhOCtOHPHxqlC8EqsFRMkKwx645ew7x3cRMYvrmyqyMLrt6ctHRt4JBx6ybpexA0g8jYnzwmyVv3PhPoWSofjjwtbZnqGk4ZcoOE6MJwEQgWLJLA9XcOYPK2-5l4ALaI6OKGxC4pAbCbS9Q068qN0I8wpDiSC3RAlFQNoRFOQTAuatD4ZFsAH_ACr5gteL85w_XwMq3_378byjNWg4OUIuHxUorqUgnRGxa1akpqRe3NBKh175bTQazcS7Qxsc3ziWk1fmViWcPqYdGZcp73MLMo9MKFHBzXqwbF_wKvsFfrIiLyHCwlvn1ccllTbYDk824cNKoYguEjCMN7nH8zgXatDgaPOO30UtzWSDZn5m0uj9gJIenUBuJ3ST1P5xLunWhqCkFJTw4iPfVviBEp0V0tGgmL3ISqjTGk4sIgMz7N0dyYCQBWu4SODQw2vKpgRj5RYzl8-gbG-DBcod5a5hkrbMad2zHvrNoEh_NBtQ5f7_oFawgFdVFBHQ0Ap9WfmdtFKd0j-Jjk6d126T0FpDWBbtgjW7X7b4zFONVTAMD0b0uxm=w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/oVwMDLP00OKkZogh2HuxmyduDpwRye-Ep9ziUoN_Pj9Q-r7LBajX21pkspFwV8unDOMVhOCtOHPHxqlC8EqsFRMkKwx645ew7x3cRMYvrmyqyMLrt6ctHRt4JBx6ybpexA0g8jYnzwmyVv3PhPoWSofjjwtbZnqGk4ZcoOE6MJwEQgWLJLA9XcOYPK2-5l4ALaI6OKGxC4pAbCbS9Q068qN0I8wpDiSC3RAlFQNoRFOQTAuatD4ZFsAH_ACr5gteL85w_XwMq3_378byjNWg4OUIuHxUorqUgnRGxa1akpqRe3NBKh175bTQazcS7Qxsc3ziWk1fmViWcPqYdGZcp73MLMo9MKFHBzXqwbF_wKvsFfrIiLyHCwlvn1ccllTbYDk824cNKoYguEjCMN7nH8zgXatDgaPOO30UtzWSDZn5m0uj9gJIenUBuJ3ST1P5xLunWhqCkFJTw4iPfVviBEp0V0tGgmL3ISqjTGk4sIgMz7N0dyYCQBWu4SODQw2vKpgRj5RYzl8-gbG-DBcod5a5hkrbMad2zHvrNoEh_NBtQ5f7_oFawgFdVFBHQ0Ap9WfmdtFKd0j-Jjk6d126T0FpDWBbtgjW7X7b4zFONVTAMD0b0uxm=w1024-h538-no" border="0" alt="kernelWidth photo kernelWidth_zpsiu1z846r.png"/></a>
</p>
<p align='center'>
Fig 5 :: Huber cost function sensitivity to kernel width 
</p>
<br> 



<br><br>
## ISAM

Started playing with [Michael Kaess's](http://people.csail.mit.edu/kaess/) stand alone ISAM library. Hopefully we will port the robust model that we select to this library so that we can utilize ISAM's incremental optimization algorithm, which is used in real-time operation on many systems. 

<br><br>

#### Installing ISAM on Ubuntu 16.04

```bash 

$ svn co https://svn.csail.mit.edu/isam
$ sudo apt-get install cmake libsuitesparse-dev libeigen3-dev libsdl1.2-dev doxygen graphviz
$ cd ~/isam; mkdir build; cd bulid; cmake ../; make install 

``` 
<br><br>

#### Inital Test 

To run an initial example ( NOTE:: if libsdl1.2-dev did not install properly you will not be able to use the GUI. )

```bash 

$ ./bin/isam data/victoriaPark.txt -G

```

The ouput should look similar to this 

<p align='center'>
<iframe width="560" height="315" src="https://www.youtube.com/embed/4ytcUgCoBG8" frameborder="0" allowfullscreen align="center" ></iframe>
</p>
<br><br>
