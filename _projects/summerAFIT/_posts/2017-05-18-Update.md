---
title: " DCS Vs. SF & Inital Testing of RRR "
layout: post
date: "2017-05-18"
author: Ryan Watson 
tags:
  - summerAFIT
  - rrr 
  - dcs 
  - switchable constraint
---

## Realizing, Reversing, Recovering 

### Good description 

> RRR divides
loop closures into clusters based on topological similarity and then tries to find the largest subset of clusters than are consistent among themselves as well as with the underlying odometry. Consistency is considered in the chi-squared ($\mathcal{X}^2)$ sense. The algorithm first carries out consistency checks for each cluster in order to weed out incorrect links within it, followed by an intra-cluster consistency check. RRR is different from the previous algorithms as it explicitly requires convergence of the graph in order to verify the validity of loop closures. In contrast with SC and DCS, in RRR and MM loop closure decisions are not modeled as continuous variables but as discrete yes/no decisions that need to be made

*REF* $\rightarrow$ [this paper](http://n.ethz.ch/~cesarc/files/IROS2014_latif.pdf) 

### Getting RRR to run on Ubuntu 16.04

```bash

$ cd ~/git
$ git clone https://github.com/ylatif/rrr.git
$ cd rrr
$ mkdir build; cd build;
$ export G2O_INCLUDE_DIR='~/Documents/git/g2o/g2o/core'
$ export G2O_LIBRARIES='~/Documents/git/g2o/lib'
$ EDITOR CMakeLists.txt

copy the following line into CMakeLists.txt so that gcc knows to 
compile the library with c++11. 


set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")

$ cmake ../; make

```


### Inital Test 

To perform an initial test of RRR, the Manhattan 3500 dataset with 10 false constraints was used. The image below shows the optimized pose graph using RRR. These results are not great ( $\mathcal{X}^2$ = 1539.7 ); however, it does show improvement over $L^2$, which has a total graph error of $\mathcal{X}^2$ = 3494.7 

<p align='center'>
<a href="https://lh3.googleusercontent.com/o1vVV8NDV4bM2j-SVGcmApkJDSBAx21vLQx5oscuMHTEfE5Uu4rYfZUHERa2rUvRpYE9J0Rq9KH7YXd2Xrneq7p5b6Qwsi1PIBY4H01Jhxdy9_JM_ci4pY_qpjGKA8GtwhANqw4yVqbk-kPAfsCV6go8MbY9PwiT96eCccyZgPfq6Bmdn5H5GWJ4tUqnWgS-dSYd-ke1W9HC21wbtI5qrcbkOnP0ljdztLNP5wt9WTCSkOItmKo8LbpNVKxvyqaykReZkEZOWEujKJjx5-lJtVkCILB3kifcEBZVC7klugnemP-dLubYG6kF3Uuu5IQp6_JSmNfVr9TC9UD2Vv9atNoau0AwpWXyXvmmsXo_ObGQHpcQJsYZ7GEhmEym9zc4AvNt_pg70VdMv1-EJLUtWGfCLdTsBFRneEZ31kZIUecsHsnBsOhZscMZu2WSwLxjRyKHbU4lW7iP_ZS_k2KDWmTwE2h1lSCvqQwrPWrI8ZnhxRrml9rRVWqziE3PTUSsbTEf-9wjTH9XSTlVKmUA8ZuiFDCna1QLOoz-L5eND5TLu1TjcL5QkLZPk4S4bCI0W6cxTL_FDjM=s642-w642-h465-no" target="_blank"><img src="https://lh3.googleusercontent.com/o1vVV8NDV4bM2j-SVGcmApkJDSBAx21vLQx5oscuMHTEfE5Uu4rYfZUHERa2rUvRpYE9J0Rq9KH7YXd2Xrneq7p5b6Qwsi1PIBY4H01Jhxdy9_JM_ci4pY_qpjGKA8GtwhANqw4yVqbk-kPAfsCV6go8MbY9PwiT96eCccyZgPfq6Bmdn5H5GWJ4tUqnWgS-dSYd-ke1W9HC21wbtI5qrcbkOnP0ljdztLNP5wt9WTCSkOItmKo8LbpNVKxvyqaykReZkEZOWEujKJjx5-lJtVkCILB3kifcEBZVC7klugnemP-dLubYG6kF3Uuu5IQp6_JSmNfVr9TC9UD2Vv9atNoau0AwpWXyXvmmsXo_ObGQHpcQJsYZ7GEhmEym9zc4AvNt_pg70VdMv1-EJLUtWGfCLdTsBFRneEZ31kZIUecsHsnBsOhZscMZu2WSwLxjRyKHbU4lW7iP_ZS_k2KDWmTwE2h1lSCvqQwrPWrI8ZnhxRrml9rRVWqziE3PTUSsbTEf-9wjTH9XSTlVKmUA8ZuiFDCna1QLOoz-L5eND5TLu1TjcL5QkLZPk4S4bCI0W6cxTL_FDjM=s642-w642-h465-no" border="0" alt="rrrInitialTest photo Screenshot from 2017-05-18 16-40-41_zpsqb6a3lyw.png"/></a>
</p>

<br><br>


## Switch Factors Vs. DCS 

This section provides a performance evaluation of Switchable constraints and DCS when faced with a faulty initial graph. To do this, four commonly used datasets were selected and false loop closure constraints were added. Using these faulty datasets we quantify performance by looking at total graph error ( $\mathcal{X}^2$ ) and the number of iterations required to reach the minimum.  

### Manhattan 3500 

The first dataset that we will look at is the commonly used Manhattan 3500. This is a simulated dataset, which was originally developed by Olson for [this paper](http://rvsn.csail.mit.edu/graphoptim/eolson-graphoptim2006.pdf). A picture of the initial pose graph is shown below.

<img src="http://www.lucacarlone.com/images/M3500_eg2o.jpg" alt="man3500" align="middle" >
<p align="center">
Pose Graph for Manhattan
</p>

<br>

Using the initial error free pose graph shown above, multiple false constraints were added to evaluate the performance of the robust optimization scheme. As a reference, the results for traditional $L^2$ optimization is shown below. ( Note, to reduce the amount of time to conduct this study, I limited the maximum number of iterations to 1000 )
<br>

| Num. False Constraints        |     Num. Iterations                      |       $\mathcal{X}^2$       |
| :---------------------------: | :------------------------------------------------: | | :------------------------------------------------: |
|    10      |   110  |  3494.8 |
|    20      |   1000 |  6519.5 | 
|    30      |   1000 |  9776.3 |                        
|    40      |   1000 | 12736.5 |
|    50      |   1000 | 13998.3 | 
{:.mbtablestyle}

<br>

The image below shows the optimization results for DCS and switch factors. Obviously, this is quite a dramatic improvement when compared to $L^2$ optimization. 

<a href="https://lh3.googleusercontent.com/02eto_PCfHl5_EQ1yJrOm8729_g7ubK8P3JO0x4ykqV9FCCfROkvUhOtFK2gXwNcWDye-TAi-Qx5mZ4Lrbk1b1mmkdLWjppn9lxN7qPthJm_ZGjk8S24_X0p4LbPEkiHZGR1JanZkUCXqER4MuZKyPE9QMn-Zpj0tuAyniJfKTNKFac_6GrNZfg_fJG7QiWglRqWuqxnJWSXEYLQVgVx_MndBUM53BiEwDkEL4Zjd2fkmk97Lb5tOFsGeZ_FzWIiuibb2HmIWlGl-GVKnRCydDkA1TMZpO0mrq20aAQncH-3LuvwsYBpHEUBM2czG6GXMe9Kt89husj_HdA49p5gF2jBVhKBuod2gnP-a5OwF-ZY09ABFKO8JO8gDi07WvkOt5fjwcObn-ANydWPU659L1gJPahOjhVN92s0PHKamwqBgMeEiSAclMpNdyR_naMfCwz0S7rhI1wSV0LNLv9Vxs2nrduM6uviuzmZfwUorZsDtiForZ1zyUMUJLG7NOrt57q2UoxYnrJUJCFkMYHDrZEZ7feb71dqJ2EJvG1WQqq_9eUtezcsd_aS2Gn5RBXjLnuKClr-vvc=s1024-w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/02eto_PCfHl5_EQ1yJrOm8729_g7ubK8P3JO0x4ykqV9FCCfROkvUhOtFK2gXwNcWDye-TAi-Qx5mZ4Lrbk1b1mmkdLWjppn9lxN7qPthJm_ZGjk8S24_X0p4LbPEkiHZGR1JanZkUCXqER4MuZKyPE9QMn-Zpj0tuAyniJfKTNKFac_6GrNZfg_fJG7QiWglRqWuqxnJWSXEYLQVgVx_MndBUM53BiEwDkEL4Zjd2fkmk97Lb5tOFsGeZ_FzWIiuibb2HmIWlGl-GVKnRCydDkA1TMZpO0mrq20aAQncH-3LuvwsYBpHEUBM2czG6GXMe9Kt89husj_HdA49p5gF2jBVhKBuod2gnP-a5OwF-ZY09ABFKO8JO8gDi07WvkOt5fjwcObn-ANydWPU659L1gJPahOjhVN92s0PHKamwqBgMeEiSAclMpNdyR_naMfCwz0S7rhI1wSV0LNLv9Vxs2nrduM6uviuzmZfwUorZsDtiForZ1zyUMUJLG7NOrt57q2UoxYnrJUJCFkMYHDrZEZ7feb71dqJ2EJvG1WQqq_9eUtezcsd_aS2Gn5RBXjLnuKClr-vvc=s1024-w1024-h538-no" border="0" alt="m3500Comp photo m3500Comp_zpsspuzzjkx.png"/></a>
<p align='center'>
Optimization results for Manhattan 3500
</p>

<br><br>


### Intel  

The next dataset we will look at was collected at Intel Reseach Lab in Seattle. This pose graph was obtained by processing the raw measurements from wheel odometry and laser range finder. The raw data can be found [here](http://ais.informatik.uni-freiburg.de/slamevaluation)

<p align = 'center'>
<img src="http://www.lucacarlone.com/images/intel_lago_map.jpg" alt="sphere3500" align="middle" >
</p>
<p align="center">
Inital Pose Graph for Sphere 3500
</p>

<br>

Again, using the initial error free pose graph shown above, multiple false constraints were added to evaluate the performance of the robust optimization scheme. The results for DCS and switch factors are shown below. To provide scale, the total graph error for $L^2$ optimization when there are 10 false constraints is $\mathcal{X}^2$ = 8076.2. 


<a href="https://lh3.googleusercontent.com/sD2TtF7aXd-chP5hKS3LWnlaOBK1IiLJRzJluWs_Qqybuh3Gm4Nqk3jj_zZBgCUgmXhfUATzPPuZimVum109iq1ESXDcmd7eAXor311El2K0RXzw0NnEApSwMP1pWayeVe5FR_tmwigHDYORhbh-zWcNqUoIh-bgdCO6JDAdPFbhMDiUVW7UBNLKRo7ZVyKmvmd2iVphvx98ROewvtIGzBbXm9eWrlKIuoCRwQejFePGzmDR5Y7bec8SbriQFEQD67WzXKT-Eksfz8L5zEulUPqrlo79ylvZlfd1Dy174yCGHOlOHnRlEybho7c9AurdqHWY85eP8hLuk9PCX0Osf8X63rXpafFDnRmZ0Kdc8nhPn-W9toT13BPQfiy3dUv0Q6YT2A95wMr1esbDrL8oN-mzjJGPSUD8B7fh8C0jb8ssaueAIpEoCw7ljNkxm3_AdMYMTxyqltSA2bducXFplrbGeO3pkv4jKYuPkrg__eTl6fO1zsQN_nonW7_BSEnodImP06r7zIvWAT6xIJuqOVRSdWE-s8qmT1PFCovEYCwexPg3gkCVm8gS3_VQsc1ZoumyrAS0fIE=s1024-w1024-h538-no" target="_blank"><img src="https://lh3.googleusercontent.com/sD2TtF7aXd-chP5hKS3LWnlaOBK1IiLJRzJluWs_Qqybuh3Gm4Nqk3jj_zZBgCUgmXhfUATzPPuZimVum109iq1ESXDcmd7eAXor311El2K0RXzw0NnEApSwMP1pWayeVe5FR_tmwigHDYORhbh-zWcNqUoIh-bgdCO6JDAdPFbhMDiUVW7UBNLKRo7ZVyKmvmd2iVphvx98ROewvtIGzBbXm9eWrlKIuoCRwQejFePGzmDR5Y7bec8SbriQFEQD67WzXKT-Eksfz8L5zEulUPqrlo79ylvZlfd1Dy174yCGHOlOHnRlEybho7c9AurdqHWY85eP8hLuk9PCX0Osf8X63rXpafFDnRmZ0Kdc8nhPn-W9toT13BPQfiy3dUv0Q6YT2A95wMr1esbDrL8oN-mzjJGPSUD8B7fh8C0jb8ssaueAIpEoCw7ljNkxm3_AdMYMTxyqltSA2bducXFplrbGeO3pkv4jKYuPkrg__eTl6fO1zsQN_nonW7_BSEnodImP06r7zIvWAT6xIJuqOVRSdWE-s8qmT1PFCovEYCwexPg3gkCVm8gS3_VQsc1ZoumyrAS0fIE=s1024-w1024-h538-no" border="0" alt="intelComp photo intelComp_zpsod0k5ac6.png"/></a>
<p align='center'>
Optimization results for Intel 
</p>

<br><br>
